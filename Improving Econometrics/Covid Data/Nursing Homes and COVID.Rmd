---
title: "Nursing Homes and COVID"
author: "Connor Krenzer"
date: "11/31/2020"
output: html_document
---

#### **The Story:** 

Old people in nursing homes are dying en masse to the coronavirus, skewing the death rate upward and providing public officials greater justification for prolonged lockdowns. This is a common talking point I have heard over the past 6 months and I think econometrics provides a unique opportunity to test it out.

**Why This Story?**

There are two reasons I am researching the coronavirus:

1.  The patients are running the asylum these days, so I have no idea who---or what---to believe. One statistic I heard from a particular political pundit is that the average age of death with COVID is older than life expectancy in the US, which suggests the virus isn't a substantial problem for healthy twenty-somethings who do not have pre-existing conditions. But is that true? What is false? Did Governor Cuomo kill Granny? I have to find that out myself.

2.  This topic provides me with an excellent introductory project on web scraping. The coronavirus is a highly publicized issue, meaning there have been countless articles and reports published on the matter. The data is all there in the articles, but it is not organized in the .csv format I have grown all too accustomed to. Most data collected for this project was pulled directly off webpages or read in from .PDF files that were created from images downloaded from webpages, all with the use of R. I have the opportunity to learn some new R packages and get hands-on experience tidying data from its raw, messy form.

**My Thoughts:**

Politicians rank highly among the handful of people who have benefitted from the coronavirus. I think they love the extra attention a little too much. Did you know who Dan McCoy was at the beginning of March this year [2020]? Me neither. I buy into the story that the nursing home fiasco we've heard so much about caused the number of deaths from the coronavirus to explode. Therefore, I expect variation in the COVID death rate (deaths from COVID) to be explained reasonably well by the rate of nursing home patients in the adult population.

```{r setup, include = FALSE}

# Code chunks will be omitted by defualt.
# Graphs will be included.
knitr::opts_chunk$set(echo = FALSE,
                      include = FALSE,
                      results = "show",
                      error = FALSE,
                      warning = FALSE,
                      message = FALSE)

```

```{r packages-import}

if(!require(pacman)) install.packages("pacman")


# General Packages
pacman::p_load(dplyr, readr,
               ggplot2, patchwork)

# Output Packages
pacman::p_load(knitr, modelsummary)


# Project-specific packages
pacman::p_load(corrplot, car, skedastic,
               pastecs, QuantPsyc, olsrr,
               perturb)

library(janitor)


# The csv file
covidData <- read_csv("COVID data.csv",
                    col_types = cols(state = col_character(),
                                     "% Wearing Mask" = col_double(),
                                     "Population Density (p/mi^2)" = col_double(),
                                     "Total Tests per 100k" = col_double(),
                                     "Has Strict Lockdown" = col_double(),
                                     "Elderly" = col_double(),
                                     "Nursing" =  col_double(),
                                     "Death Rate" = col_double(),
                                     "Urban.Density" = col_double()))


```

**The Model:**

Using regression analysis subject to the BLUE method of Least Squares, I will test cross-sectional data from the 50 states and DC using the following equation:

\$Deaths = β~1~ + β~2~Nursing + β~3~Tests +
β~4~Elderly + β~5~Mask + β~6~Density + β~7~Lockdown\$

+--------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| **Variable**             | **Definition**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | **Source**                                                                                                                                                                              |
+:========================:+:=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================:+:=======================================================================================================================================================================================:+
| Deaths (Y)               | The sum of the increase in deaths from the previous day from October 19th, 2020 to October 23rd, 2020 as a rate per 100000 persons, where deaths are defined as the "Total fatalities with confirmed OR probable case diagnoses (per the expanded CSTE case definition of April 5th, 2020 approved by the CDC) In states where the information is available, it only tracks fatalities with confirmed OR probable COVID-19 case diagnosis where on the death certificate, COVID-19 is listed as an underlying cause of death according to WHO guidelines."                                                                        | The COVID Tracking Project for the                                                                                                                                                      |
|                          |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | death data.                                                                                                                                                                             |
|                          |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |                                                                                                                                                                                         |
|                          |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | Kaiser                                                                                                                                                                                  |
|                          |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | Family Foundation analysis of Certification and Survey Provider Enhanced                                                                                                                |
|                          |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | Reports (CASPER) data for the population data.                                                                                                                                          |
+--------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Nursing (β~2~)           | The number of people in nursing homes per 100000 adults.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | Kaiser Family Foundation analysis of Certification and Survey Provider Enhanced Reports (CASPER) data; The CASPER system includes data for all certified nursing facilities in the U.S. |
+--------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Tests (β~3~)             | The total number of tests completed on October 23rd per 100000 residents.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | Pulled from predictcovid.com, who pulled their data from The COVID Tracking Project (who, of course, compiles their information from many local, regional, state, and federal sources). |
+--------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Elderly (β~4~)           | The percent of the population 65 years and older.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | Kaiser Family Foundation analysis of Certification and Survey Provider Enhanced Reports (CASPER) data.                                                                                  |
+--------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Mask (β~5~)              | The percentage of state residents who say they wear a mask in public all or most of the time.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | The Washington Post (who got it from Delphi CovidCast, Carnegie Mellon University).                                                                                                     |
+--------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Density (β~6~)           | The state's 2020 population divided by the land area (miles squared).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | Pulled from World Population Review's website, who pulled the data from the US Census State Population Estimates Program.                                                               |
+--------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Lockdown (β~7~)          | Dummy Variable determining the severity of government lockdowns as determined by the Washington Post as of September 11th, 2020 on a scale of "No Restrictions", "Some Minor Restrictions", "Moderate Restrictions", and "Major Restrictions" with zeros being No/Minor Restrictions and ones being Moderate/Major Restrictions. Note: Any state with a "\_CONDITION\_ restrictions vary by region" caveat are pooled in with the severity of the lockdown representative of the entire state (Ex. Illinois says "Moderate restrictions vary by region" but is still considered "Moderate" and therefore is a one in this model). | Washington Post.                                                                                                                                                                        |
+--------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Urban (introduced later) | 2010 urban land area (the "physical city"), measured in square miles, divided by urban population.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | Data pulled from newsgeography.com; they collected the data from the U.S. Census Bureau.                                                                                                |
+--------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

|    Variable     | Expected Sign | Expected Statistical Significance | Expected Practical Significance |
|:---------------:|:-------------:|:---------------------------------:|:-------------------------------:|
| Nursing (β~2~)  |      \+       |         Low Significance          |      Moderate Significance      |
|  Tests (β~3~)   |      \-       |       Moderate Significance       |      Moderate Significance      |
| Elderly (β~4~)  |      \+       |       Moderate Significance       |      Moderate Significance      |
|   Mask (β~5~)   |      \-       |         High Significance         |        High Significance        |
| Density (β~6~)  |      \+       |         Low Significance          |        Low Significance         |
| Lockdown (β~7~) |      \-       |       Moderate Significance       |      Moderate Significance      |
|      Urban      |      \+       |       Moderate Significance       |      Moderate Significance      |

**Hesitations**

A weakness key to my variables deals with time---the timeframes on several of my variables do not line up properly. The most notable of these variables is the lockdown variable, which was last updated on September 11^th^, 2020, while several other variables use data from October 23^rd^, 2020. The urban variable used in later iterations of the model contains data from 2010; though it is unlikely drastic urban expansions have happened from one state to another in the last ten years, more recent data would only increase the reliability of the results. Smaller problems dealing with time are with regards to the Nursing (B2) and Elderly (B4) variables. The data in those are from 2019 and---although the difference will probably not matter with elderly---if people are worried about patients in nursing facilities catching the coronavirus, it is possible that many who were in nursing facilities a year ago have decided to go elsewhere, reducing the accuracy of the nursing variable. Another problem is that DC will heavily skew the population density results. Regardless of the accuracy of this model, the coronavirus' dangers cannot be dismissed if all the variables explain little of the variation in the COVID death rate. Other factors, such as lingering symptoms or permanent health problems from the virus also need consideration in discussions of policy.

```{r descriptive statistics}

death <- stat.desc(covidData$`Death Rate`)[c(4:6, 8, 9, 13)]
mask <- stat.desc(covidData$`% Wearing Mask`)[c(4:6, 8, 9, 13)]
tests <- stat.desc(covidData$`Total Tests per 100k`)[c(4:6, 8, 9, 13)]
elderly <- stat.desc(covidData$Elderly)[c(4:6, 8, 9, 13)]
nursing <- stat.desc(covidData$Nursing)[c(4:6, 8, 9, 13)]
density <- stat.desc(covidData$`Population Density (p/mi^2)`)[c(4:6, 8, 9, 13)]

# Prints descriptive statistics
kable(t(data.frame(death, mask, tests, elderly, nursing, density)), caption = "Descriptive Statistics")

rm(death, mask, tests, elderly, nursing, density)

```

**Simple Regression Models**

The beginning of the analysis applied each explanatory variable in a simple linear regression against the dependent variable, "Death" with a 95 percent confidence interval. The calculations are provided in the table below:

```{r simple linear models}

simple_mask <- lm(data = covidData, formula = `Death Rate` ~ `% Wearing Mask`)

simple_pop <- lm(data = covidData, formula = `Death Rate` ~ `Population Density (p/mi^2)`)

simple_test <- lm(data = covidData, formula = `Death Rate` ~ `Total Tests per 100k`)

simple_lockdown <- lm(data = covidData, formula = `Death Rate` ~ `Has Strict Lockdown`)

simple_elderly <- lm(data = covidData, formula = `Death Rate` ~ `Elderly`)

simple_nursing <- lm(data = covidData, formula = `Death Rate` ~ `Nursing`)


modelsummary(models = list(
            "Mask" = simple_mask,
            "Density" = simple_pop,
            "Test" = simple_test,
            "Lockdown" = simple_lockdown,
            "Elderly" = simple_elderly,
            "Nursing" = simple_nursing),
            statistic = c("p.value", "conf.int", "std.error", "statistic"),
            output = "markdown")

# Removing old variables
rm(simple_mask, simple_pop, simple_test, simple_lockdown, simple_elderly, simple_nursing)

```

The table above shows that two of the explanatory variables have statistically significant p-values at the 0.001 level of significance, and three of the six explanatory variables have statistically significant p-values at the 0.05 level. The explanatory variable this study is most interested in, the number of people in certified nursing facilities per 100,000 adults (Nursing), has an R-square just below 0.29, meaning roughly 29 percent of the variation in the number of new deaths to the coronavirus---controlled for population size---is explained by changes in the number of nursing home residents. The coefficient for the nursing home population, 3.6829, suggests that an increase of one person per 100,000 state residents in nursing facilities will increase the number of people who die from the coronavirus by 3-4 per 100,000 state residents. Among the three variables that are statistically significant, only the lockdown and nursing home variables are practically significant with a beta value greater than one. A one percent increase in the percent of people wearing masks will only decrease the number of deaths due to the coronavirus by roughly one in one million.

Further, it is important to note that all variables were assumed to have a straight-line relationship with the dependent variable. The figure below plots all explanatory variables against the dependent variable. No obvious relationship emerges from any of the variables, so a straight-line relationship will be assumed for each variable. In fact, preliminary tests performed showed regression statistics are slightly improved by adopting a quadratic relationship between the variables, yet no clear, logical explanation why this may be the case is apparent from the data, and no obvious story can be told using a different linear relationship.

```{r plots}

# This section of code plots all the different variables against one another.

noRestr <- covidData %>%
  filter(`Has Strict Lockdown` == 0)

restr <- covidData %>%
  filter(`Has Strict Lockdown` == 1)

noRestr <- ggplot(data = noRestr) +
  geom_boxplot(mapping = aes(`Death Rate`)) +
  xlab("Death Rate (no strict lockdown)")
restr <- ggplot(data = restr) +
  geom_boxplot(mapping = aes(`Death Rate`)) +
  xlab("Death Rate (strict lockdown)") +
  xlim(c(0, 8))

# plotting everything against the death rate
qplot(covidData$Nursing, covidData$`Death Rate`, xlab = "Nursing", ylab = "Death Rate") +
  qplot(covidData$`Total Tests per 100k`, covidData$`Death Rate`, xlab = "Tests", ylab = "Death Rate") +
  qplot(covidData$Elderly, covidData$`Death Rate`, xlab = "Elderly", ylab = "Death Rate") +
  qplot(covidData$`% Wearing Mask`, covidData$`Death Rate`, xlab = "Mask", ylab = "Death Rate") +
  qplot(covidData$`Population Density (p/mi^2)`, covidData$`Death Rate`, xlab = "Density (Excluding DC)", ylab = "Death Rate", xlim = c(0, 1500)) /
  qplot(covidData$`Population Density (p/mi^2)`, covidData$`Death Rate`, xlab = "Density (Including DC)", ylab = "Death Rate") +
  restr / noRestr + plot_annotation(title = "Explanatory Variables vs. Dependent Variable (New Deaths from COVID)")


# Removing old variables
rm(noRestr, restr)

```

**Multivariate Regression Models**

The following table displays the preliminary results estimating the COVID death rate (the dependent variable) using a linear regression model containing a 95 percent confidence interval with all six explanatory variables included.

```{r initial multiple regression}

results <- lm(data = covidData, `Death Rate` ~ Nursing +
                Elderly + `% Wearing Mask` +
                `Population Density (p/mi^2)`+
                `Total Tests per 100k` +
                `Has Strict Lockdown`)

modelsummary(models = list(results),
            statistic = c("p.value", "conf.int", "std.error", "statistic"),
            notes = "Predictors: Percent Wearing Masks, State Population Density, Total COVID Tests Per 100k, Percent of Population over 65, Nursing Home Residents Per 100k Adults",
            output = "markdown")

# Removing old variables
rm(results)

```

The R-square value of .5028 suggests that the variables included in the regression model explain approximately half of the variation in the dependent variable. The far lower adjusted R-square value indicates that many of the variables contribute little to the model, which is supported by the low R-squares found in the simple linear regression models.

Compared with the simple regression models, the t-stats and p-values of the explanatory variables changed drastically. The nursing and mask variables remain significant, yet the lockdown variable's p-value moved from 0.025 in the simple linear regression all the way to 0.952 in the multiple regression. All other variables that were not statistically significant in the simple linear regressions had similar bumps in their p-values. The population density variable, for example, had a p-value of 0.137 in the simple linear regression and moved all the way to 0.777 in the multiple regression.

The increase in p-values across all variables indicates multicollinearity exists among the explanatory variables. To determine the extent that collinearity is an issue with the variables in the model, data for the explanatory variables will be examined both visually and with correlation coefficients.

**Examining Multicollinearity**

After testing for multicollinearity, there is a high likelihood that multiple variables will move in tandem with one another in a linear regression model. The correlation matrix below visualizes the extent to which multicollinearity affects each variable. For a quantitative approach, the table beneath the correlation matrix provides the absolute value of the zero-order correlation coefficients between variables.

```{r correlation}

# The correlation coefficients
correlation <- as.data.frame(cor(covidData[,c(-1 ,-5, -8, -9)]))

# Renaming the variables the way they are in my official model in the document
colnames(correlation) <- c("Mask", "Density", "Tests", "Elderly", "Nursing")
rownames(correlation) <- c("Mask", "Density", "Tests", "Elderly", "Nursing")


# Visualizing correlation between the variables (corrplot takes a matrix as input, I think)
corrplot(corr = as.matrix(correlation),
         title = "Correlation Matrix",
         method = "pie",
         type = "upper",
         tl.srt = 0,
         outline = "black",
         tl.pos = "d",
         tl.col = "black",
         tl.cex = 1.5,
         cl.cex = 1.5,
         diag = T)

# The numeric output
datasummary_correlation(correlation,
                        title = "Zero-Order Correlation Coefficients",
                        output = "markdown")

```

Of the 10 possible combinations of the explanatory variables---excluding the lockdown variable because Pearson correlations require continuous variables---all but three exhibit a negligible degree of multicollinearity (defined as a zero-order correlation coefficient less than \|0.3\|). To examine the three combinations with a higher degree of multicollinearity, the t-stat between each relationship will be considered. The following table details the statistical significance of the variable combinations with a zero-order correlation greater than \|0.3\|:

```{r testing multicollinearity via regressions}

# linear model of masks against density
summary(lm(formula = covidData$`Population Density (p/mi^2)` ~ covidData$`% Wearing Mask`))


# linear model of masks against nursing
summary(lm(formula = covidData$Nursing ~ covidData$`% Wearing Mask`))

# linear model of density against tests
summary(lm(formula = covidData$`Total Tests per 100k` ~ covidData$`Population Density (p/mi^2)`))



```
