---
title: "Nursing Homes and COVID"
author: "Connor Krenzer"
date: "11/31/2020"
output: html_document
---

#### **The Story:** 

Old people in nursing homes are dying en masse to the coronavirus, skewing the death rate upward and providing public officials greater justification for prolonged lockdowns. This is a common talking point I have heard over the past 6 months and I think econometrics provides a unique opportunity to test it out.

**Why This Story?**

There are two reasons I am researching the coronavirus:

1.  The patients are running the asylum these days, so I have no idea who---or what---to believe. One statistic I heard from a particular political pundit is that the average age of death with COVID is older than life expectancy in the US, which suggests the virus isn't a substantial problem for healthy twenty-somethings who do not have pre-existing conditions. But is that true? What is false? Did Governor Cuomo kill Granny? I have to find that out myself.

2.  This topic provides me with an excellent introductory project on web scraping. The coronavirus is a highly publicized issue, meaning there have been countless articles and reports published on the matter. The data is all there in the articles, but it is not organized in the .csv format I have grown all too accustomed to. Most data collected for this project was pulled directly off webpages or read in from .PDF files that were created from images downloaded from webpages, all with the use of R. I have the opportunity to learn some new R packages and get hands-on experience tidying data from its raw, messy form.

**My Thoughts:**

Politicians rank highly among the handful of people who have benefitted from the coronavirus. I think they love the extra attention a little too much. Did you know who Dan McCoy was at the beginning of March this year [2020]? Me neither. I buy into the story that the nursing home fiasco we've heard so much about caused the number of deaths from the coronavirus to explode. Therefore, I expect variation in the COVID death rate (deaths from COVID) to be explained reasonably well by the rate of nursing home patients in the adult population.

```{r setup, include = FALSE}

# Code chunks will be omitted by defualt.
# Graphs will be included.
knitr::opts_chunk$set(echo = FALSE,
                      include = FALSE,
                      results = "show",
                      error = FALSE,
                      warning = FALSE,
                      message = FALSE)

```

```{r packages-import}

if(!require(pacman)) install.packages("pacman")


# General Packages
pacman::p_load(dplyr, readr,
               ggplot2, patchwork)

# Output Packages
pacman::p_load(knitr, modelsummary)


# Project-specific packages
pacman::p_load(corrplot, car, skedastic,
               pastecs, QuantPsyc, olsrr,
               perturb)

library(janitor)


# The csv file
covidData <- read_csv("COVID data.csv",
                    col_types = cols(state = col_character(),
                                     "% Wearing Mask" = col_double(),
                                     "Population Density (p/mi^2)" = col_double(),
                                     "Total Tests per 100k" = col_double(),
                                     "Has Strict Lockdown" = col_double(),
                                     "Elderly" = col_double(),
                                     "Nursing" =  col_double(),
                                     "Death Rate" = col_double(),
                                     "Urban.Density" = col_double()))


```

**The Model:**

Using regression analysis subject to the BLUE method of Least Squares, I will test cross-sectional data from the 50 states and DC using the following equation:

\$Deaths = β~1~ + β~2~Nursing + β~3~Tests +
β~4~Elderly + β~5~Mask + β~6~Density + β~7~Lockdown\$

+--------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| **Variable**             | **Definition**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | **Source**                                                                                                                                                                              |
+:========================:+:=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================:+:=======================================================================================================================================================================================:+
| Deaths (Y)               | The sum of the increase in deaths from the previous day from October 19th, 2020 to October 23rd, 2020 as a rate per 100000 persons, where deaths are defined as the "Total fatalities with confirmed OR probable case diagnoses (per the expanded CSTE case definition of April 5th, 2020 approved by the CDC) In states where the information is available, it only tracks fatalities with confirmed OR probable COVID-19 case diagnosis where on the death certificate, COVID-19 is listed as an underlying cause of death according to WHO guidelines."                                                                        | The COVID Tracking Project for the                                                                                                                                                      |
|                          |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | death data.                                                                                                                                                                             |
|                          |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |                                                                                                                                                                                         |
|                          |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | Kaiser                                                                                                                                                                                  |
|                          |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | Family Foundation analysis of Certification and Survey Provider Enhanced                                                                                                                |
|                          |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | Reports (CASPER) data for the population data.                                                                                                                                          |
+--------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Nursing (β~2~)           | The number of people in nursing homes per 100000 adults.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | Kaiser Family Foundation analysis of Certification and Survey Provider Enhanced Reports (CASPER) data; The CASPER system includes data for all certified nursing facilities in the U.S. |
+--------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Tests (β~3~)             | The total number of tests completed on October 23rd per 100000 residents.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | Pulled from predictcovid.com, who pulled their data from The COVID Tracking Project (who, of course, compiles their information from many local, regional, state, and federal sources). |
+--------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Elderly (β~4~)           | The percent of the population 65 years and older.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | Kaiser Family Foundation analysis of Certification and Survey Provider Enhanced Reports (CASPER) data.                                                                                  |
+--------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Mask (β~5~)              | The percentage of state residents who say they wear a mask in public all or most of the time.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | The Washington Post (who got it from Delphi CovidCast, Carnegie Mellon University).                                                                                                     |
+--------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Density (β~6~)           | The state's 2020 population divided by the land area (miles squared).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | Pulled from World Population Review's website, who pulled the data from the US Census State Population Estimates Program.                                                               |
+--------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Lockdown (β~7~)          | Dummy Variable determining the severity of government lockdowns as determined by the Washington Post as of September 11th, 2020 on a scale of "No Restrictions", "Some Minor Restrictions", "Moderate Restrictions", and "Major Restrictions" with zeros being No/Minor Restrictions and ones being Moderate/Major Restrictions. Note: Any state with a "\_CONDITION\_ restrictions vary by region" caveat are pooled in with the severity of the lockdown representative of the entire state (Ex. Illinois says "Moderate restrictions vary by region" but is still considered "Moderate" and therefore is a one in this model). | Washington Post.                                                                                                                                                                        |
+--------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Urban (introduced later) | 2010 urban land area (the "physical city"), measured in square miles, divided by urban population.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | Data pulled from newsgeography.com; they collected the data from the U.S. Census Bureau.                                                                                                |
+--------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

|    Variable     | Expected Sign | Expected Statistical Significance | Expected Practical Significance |
|:---------------:|:-------------:|:---------------------------------:|:-------------------------------:|
| Nursing (β~2~)  |      \+       |         Low Significance          |      Moderate Significance      |
|  Tests (β~3~)   |      \-       |       Moderate Significance       |      Moderate Significance      |
| Elderly (β~4~)  |      \+       |       Moderate Significance       |      Moderate Significance      |
|   Mask (β~5~)   |      \-       |         High Significance         |        High Significance        |
| Density (β~6~)  |      \+       |         Low Significance          |        Low Significance         |
| Lockdown (β~7~) |      \-       |       Moderate Significance       |      Moderate Significance      |
|      Urban      |      \+       |       Moderate Significance       |      Moderate Significance      |

**Hesitations**

A weakness key to my variables deals with time---the timeframes on several of my variables do not line up properly. The most notable of these variables is the lockdown variable, which was last updated on September 11^th^, 2020, while several other variables use data from October 23^rd^, 2020. The urban variable used in later iterations of the model contains data from 2010; though it is unlikely drastic urban expansions have happened from one state to another in the last ten years, more recent data would only increase the reliability of the results. Smaller problems dealing with time are with regards to the Nursing (B2) and Elderly (B4) variables. The data in those are from 2019 and---although the difference will probably not matter with elderly---if people are worried about patients in nursing facilities catching the coronavirus, it is possible that many who were in nursing facilities a year ago have decided to go elsewhere, reducing the accuracy of the nursing variable. Another problem is that DC will heavily skew the population density results. Regardless of the accuracy of this model, the coronavirus' dangers cannot be dismissed if all the variables explain little of the variation in the COVID death rate. Other factors, such as lingering symptoms or permanent health problems from the virus also need consideration in discussions of policy.

```{r descriptive statistics}

death <- stat.desc(covidData$`Death Rate`)[c(4:6, 8, 9, 13)]
mask <- stat.desc(covidData$`% Wearing Mask`)[c(4:6, 8, 9, 13)]
tests <- stat.desc(covidData$`Total Tests per 100k`)[c(4:6, 8, 9, 13)]
elderly <- stat.desc(covidData$Elderly)[c(4:6, 8, 9, 13)]
nursing <- stat.desc(covidData$Nursing)[c(4:6, 8, 9, 13)]
density <- stat.desc(covidData$`Population Density (p/mi^2)`)[c(4:6, 8, 9, 13)]

# Prints descriptive statistics
kable(t(data.frame(death, mask, tests, elderly, nursing, density)), caption = "Descriptive Statistics")

rm(death, mask, tests, elderly, nursing, density)

```

**Simple Regression Models**

The beginning of the analysis applied each explanatory variable in a simple linear regression against the dependent variable, "Death" with a 95 percent confidence interval. The calculations are provided in the table below:

```{r simple linear models}

simple_mask <- lm(data = covidData, formula = `Death Rate` ~ `% Wearing Mask`)

simple_pop <- lm(data = covidData, formula = `Death Rate` ~ `Population Density (p/mi^2)`)

simple_test <- lm(data = covidData, formula = `Death Rate` ~ `Total Tests per 100k`)

simple_lockdown <- lm(data = covidData, formula = `Death Rate` ~ `Has Strict Lockdown`)

simple_elderly <- lm(data = covidData, formula = `Death Rate` ~ `Elderly`)

simple_nursing <- lm(data = covidData, formula = `Death Rate` ~ `Nursing`)






modelsummary(models = list(
            "Mask" = simple_mask,
            "Density" = simple_pop,
            "Test" = simple_test,
            "Lockdown" = simple_lockdown,
            "Elderly" = simple_elderly,
            "Nursing" = simple_nursing),
            statistic = c("p.value", "conf.int", "std.error", "statistic"),
            output = "markdown")
```

The table above shows that two of the explanatory variables have statistically significant p-values at the 0.001 level of significance, and three of the six explanatory variables have statistically significant p-values at the 0.05 level. The explanatory variable this study is most interested in, the number of people in certified nursing facilities per 100,000 adults (Nursing), has an R-square just below 0.29, meaning roughly 29 percent of the variation in the number of new deaths to the coronavirus---controlled for population size---is explained by changes in the number of nursing home residents. The coefficient for the nursing home population, 3.6829, suggests that an increase of one person per 100,000 state residents in nursing facilities will increase the number of people who die from the coronavirus by 3-4 per 100,000 state residents. Among the three variables that are statistically significant, only the lockdown and nursing home variables are practically significant with a beta value greater than one. A one percent increase in the percent of people wearing masks will only decrease the number of deaths due to the coronavirus by roughly one in one million.

Further, it is important to note that all variables were assumed to have a straight-line relationship with the dependent variable. The figure below plots all explanatory variables against the dependent variable. No obvious relationship emerges from any of the variables, so a straight-line relationship will be assumed for each variable. In fact, preliminary tests performed showed regression statistics are slightly improved by adopting a quadratic relationship between the variables, yet no clear, logical explanation why this may be the case is apparent from the data, and no obvious story can be told using a different linear relationship.
